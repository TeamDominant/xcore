---
- name: Create Xray directories structure
  file:
    path: "{{ item.path }}"
    state: directory
    mode: "{{ item.mode }}"
  loop:
    - { path: "{{ remote_path }}/xray", mode: '0755' }
    - { path: "{{ remote_path }}/xray/config", mode: '0755' }

- name: Create Xray log files with proper permissions
  file:
    path: "{{ remote_path }}/xray/config/{{ item }}"
    state: touch
    mode: '0644'
  loop:
    - access.log
    - error.log

- name: Deploy Xray configuration files
  template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: "{{ item.mode }}"
  loop:
    - { src: 'config.json.j2', dest: '{{ remote_path }}/xray/config/config.json', mode: '0644' }
    - { src: 'Dockerfile.j2', dest: '{{ remote_path }}/xray/Dockerfile', mode: '0644' }
