// 1. Источники обновлений (Critical Fix: Разделение логики Debian и Ubuntu)
Unattended-Upgrade::Allowed-Origins {
{% if ansible_distribution == 'Ubuntu' %}
    // Настройки для Ubuntu (Здесь оставляем, так как apt-release-tools их понимает)
    "${distro_id}:${distro_codename}";
    "${distro_id}:${distro_codename}-security";
    "${distro_id}ESMApps:${distro_codename}-apps-security";
    "${distro_id}ESM:${distro_codename}-infra-security";
{% else %}
    // Настройки для чистого Debian
    "origin=Debian,codename={{ ansible_distribution_release }},label=Debian";
    "origin=Debian,codename={{ ansible_distribution_release }},label=Debian-Security";
    
    // Совместимость со старым форматом
    "{{ ansible_distribution }}:{{ ansible_distribution_release }}-security";
{% endif %}
};

// 2. Черный список пакетов (если нужно что-то исключить)
Unattended-Upgrade::Package-Blacklist {
};

// 3. Настройка Email
Unattended-Upgrade::Mail "{{ autoupdate_email_to }}";
// Слать почту только при ошибках (on-error) или всегда (always)?
Unattended-Upgrade::MailReport "on-change";

// 4. Автоматическая очистка старых ядер и зависимостей
Unattended-Upgrade::Remove-Unused-Kernel-Packages "true";
Unattended-Upgrade::Remove-Unused-Dependencies "true";
Unattended-Upgrade::Automatic-Reboot-WithUsers "false";

// 5. Автоматическая перезагрузка
Unattended-Upgrade::Automatic-Reboot "{{ 'true' if autoupdate_reboot | bool else 'false' }}";
{% if autoupdate_reboot | bool %}
Unattended-Upgrade::Automatic-Reboot-Time "{{ autoupdate_reboot_time }}";
{% endif %}
