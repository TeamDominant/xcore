---
- name: Load BBR module
  ansible.builtin.modprobe:
    name: tcp_bbr
    state: present

- name: Load on boot
  ansible.builtin.copy:
    content: "tcp_bbr"
    dest: /etc/modules-load.d/bbr.conf

- name: Configure Sysctl
  ansible.posix.sysctl:
    name: "{{ item.key }}"
    value: "{{ item.value }}"
    state: present
    reload: yes
  loop:
    - { key: 'net.core.default_qdisc', value: "{{ bbr_qdisc }}" }
    - { key: 'net.ipv4.tcp_congestion_control', value: "{{ bbr_control }}" }
